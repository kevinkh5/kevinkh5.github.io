---
title: '[Sieve of Eratosthenes] 에라토스테네스의체 효율적으로 여러 개의 소수 구하기'
author: baduk
date: 2024-03-11 15:21:00 +0900
categories: [Study, Discrete Mathematics]
tags: [study, python, problem solving, algorithm]
use_math: true
---

## 소수(Prime Number)
소수는 약수가 1과 자기 자신밖에 없는 수를 뜻하고, 소수가 아닌 수를 합성수라고 한다. 0과 1은 소수가 아니다. 2,3,5,7,11은 모두 소수다.

## 소수 구하기
소수는 어떻게 구할 수 있을까? 약수가 1과 자기자신 밖에 없다는 소수의 특징을 가지고 간단하게 파이썬 코드로 구현하자면 아래와 같다.

```python
def is_prime(n):
    if n <= 1:
        return False
    for i in range(2,int(n**0.5)+1):
        if n%i == 0:
            return False
    return True
```

일단 0과 1은 소수가 아니므로 False를 리턴한다. 그 외에 2 이상의 수에 대해서는 반복문안에서 모듈러 연산을 통해 구할 수 있다. 예를들어 5가 소수인지 아닌지 판별하려면 5(n)가 2로 나누어 떨어지는지 체크, 3으로 나누어 떨어지는지 체크, 4로 나누어 떨어지는지 체크, 그러다가 딱 나누어 떨어지는 수가 없으면 소수이므로 True를 리턴한다.

하지만 여기서 중요한 것은 2부터 n-1까지 모든 수를 체크할 필요가 없다는 것이다. 그 이유는 아래 예시를 보면 납득이 될 것이다. 예를 들어 13이 소수인지 아닌지를 판별하려고 한다. 13이 소수인지 아닌지를 판별하는 가장 간단한 방법은 2부터 12까지 차례대로 13이 나누어떨어지는지 체크하는 것이다.

하지만 이 같은 방법 말고, 13을 만드려면 어떤 두 정수를 곱해야할까를 고민하는데에서 출발해보자. 어쨌든 13을 만들 수 있는 두 정수의 곱이 있는지 없는지 찾는 것도 소수인지 아닌지 판별하는 방법이니까.

2랑 어떤 수 A랑 곱했을 때 13을 만드는 수 A가 있을까? 2에 6을 곱하면 12로 13보다 조금 모자르고 7을 곱하면 14로 13보다 조금 더 크다. 즉 13을 만들 수 있는 2와 어떤 수 A는 없다.

3과 어떤 수 A랑 곱했을 때 13을 만드는 수 A가 있을까? 3에 4를 곱하면 12로 13보다 조금 모자르고 5를 곱하면 15로 13보다 조금 더 크다. 즉 13을 만들 수 있는 3과 어떤 수 A는 없다.

여기서 중요한 것! 4와 어떤 수 A를 곱했을 때 13을 만드는 수 A가 있는지 없는지 확인해볼 필요 있을까? 결론적으로는 13을 만드는 4와 어떤 수 A는 찾을 필요가 없다. 그 이유는 이미 앞에서 다해보았기 때문이다.

이해가가는가? 앞에서 우리는 이미 2 * 6, 2 * 7, 3 * 4, 3 * 5를 다 시도했다. 즉 뒤에 수 4, 5, 6, 7은 해볼 필요도 없다. 즉 13을 만들 수 있는 약수(1 과 13을 제외한)가 없으므로 13은 소수다.

따라서 13의 소수인지 아닌지를 알아내기위해 2, 3만 시도 해보면 된다. `이를 일반화하면 우리는 2부터 n의 제곱근(여기서는 대략 3)까지의 수만 가지고 n이 나누어 떨어지는지 체크하면 된다.` 2부터 n-1까지의 수를 모두 체크할 필요가 전혀없다.

## 여러개의 소수 구하기 (에라토스테네스의 체의 원리)

소수 몇개만 구한다면 위 코드로 단순하게 구하는 것도 괜찮은 방법이다. 하지만 많은 소수를 구해야 한다면 좀 더 효율적인 방법이 필요하다. 여러개의 소수를 구하는 방법으로 우리는 에라토스테네스의 체 알고리즘을 사용할 수 있다.

에라토스테네스의 체의 아이디어는 간단하다. 예를들어 1부터 25까지 모든 소수를 구한다고 해보자. 그럼 1은 일단 소수가 아니므로 지운다. 그리고 1의 다음 수인 2의 배수 4부터 6, 8, 10, 12 ... 24까지 2를 제외한 모든 2의 배수를 지운다. 그리고 다음 수인 3의 배수를 6부터 9, 12, 15,... 24까지 지운다. 물론 6과 12, 24는 또한 2의 배수이므로 앞서 이미 지워졌을 것이다. 이런식으로 4의 배수도 지우고 5의 배수도 지운다. 그리고 남은 수가 소수다.

그런데 여기서 문제! 6의 배수도 체크해 볼 필요가 있을까? 결론적으로 6의 배수는 체크할 필요가 없다. 일단 앞에서 2 * 6(2의 배수를 지우는 과정에서), 3 * 6(3의 배수를 지우는 과정에서), 4 * 6(4의 배수를 지우는 과정에서)은 다 해봤을 거고, 5 * 6은 25보다 크므로 해볼 필요없어 안했을 것이다. 그럼 6 * 6은? 25보다 크므로 할 필요없고, 그 뒤로도 25보다 클테니까 할 필요없다.

즉, 이를 일반화하면 1부터 25까지의 모든 소수를 구한다고 했을 때, 25의 제곱근인 5까지만 체크해보면 되고 6부터는 체크할 필요가 없다. 2 * 6, 3 * 6, 4 * 6은 다 했던 작업이고, 그 뒤로는 25보다 크니까 할 필요없기 때문이다. 즉 자기 자신의 제곱이 소수인지 판별하고자하는 최대 수 보다 크면 할 필요없다.

## 에라토스테네스의 체 파이썬 구현
```python
def era_prime(n):
    tf_prime = [True]*(n+1)
    tf_prime[0], tf_prime[1] = False, False
    prime = []
    # 에라토스테네스의 체 테이블 만들기 (True or False)
    for i in range(2,int(n**0.5)+1):
        if tf_prime[i]:
            prime.append(i)
            for j in range(2*i,n+1,i): # 2*i 부터 시작하지 않고 i**2부터 시작해도 됨.
                tf_prime[j] = False
    # 에라토스테네스의 체 테이블 만드는 동안
    # 못담은 나머지 소수인 수 리스트에 담기
    for i in range(int(n**0.5)+1,n+1):
        if tf_prime[i]:
            prime.append(i)

    return tf_prime,prime
```